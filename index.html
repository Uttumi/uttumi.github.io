<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		
		<title>Portfolio of Jouni Sarvanko</title>
		
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
		<link rel="stylesheet" href="stylesheets/portfolio_styles.css">
		
		<script src='javascripts/libraries/jquery-1.9.1.js'></script>
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>

		<script>
			function CreateNavigationFromIndexJson()
			{
				var json = null;

				$.getJSON
				(
					'portfolio/index.json',
					function(data)
					{
						console.log('Opened index.json');
						
						json = data;
						
						console.debug(JSON.stringify(data));

						CreateNavigationElement(null, {key: 'root', value: data}, 1);
					}
				)
				.error ( function() { console.debug('Could not open index.json'); } )
				
				return json;
			}
			
			function CreateNavigationElement(own_list_item, json_tuple, list_level)
			{
				var images = GetArrayByKey(json_tuple.value, 'images');
				var videos = GetArrayByKey(json_tuple.value, 'videos');
				var webpages = GetArrayByKey(json_tuple.value, 'webpages');

				var subelements = GetComplexElementList(json_tuple.value);
				
				if(own_list_item != null)
				{
					own_list_item.find('input').click(
						function ()
						{ 
							NavigationClick(json_tuple.key, images, videos, webpages) 
						}
					);
				}

				console.debug('Number of subelements: '+ subelements.length);
				
				if(subelements.length > 0)
				{
					var navigation_sublist = null; 
					
					if(own_list_item == null)
						navigation_sublist = $('#level_1');
					else
					{
						navigation_sublist = $('<ul />', {id: 'level_'+ list_level});
						$('<div />').html(navigation_sublist).appendTo(own_list_item);
					}
				
					$.each
					(
						subelements,
						function( index, tuple )
						{
							var child_list_item = $('<li />').appendTo(navigation_sublist);
							$('<label />', 
								{ 
								for: tuple.key +'_input' 
								}
							).html(tuple.key).appendTo(child_list_item);
							
							$('<input />', 
								{ 
								type: 'radio', 
								name: 'vertical_menu_'+ list_level, 
								id: tuple.key +'_input',
								}
							).appendTo(child_list_item);
							
							console.debug('Element name: '+ tuple.key);
							console.debug('Element type: '+ $.type(tuple.value));
							CreateNavigationElement(child_list_item, tuple, list_level+1);
						}
					)
				}
			}
			
			function NavigationClick(key, images, videos, webpages)
			{
				console.debug('Clicked '+ key);
				
				var content_area = $('#content_area');
				
				content_area.empty();
				
				AddImages(content_area, images);
				AddVideos(content_area, videos);
			}
			
			function AddImages(content_area, images)
			{
				if(images == null)
					return;
					
				var total_elements = images.length; /* + videos.length + webpages.length;*/
				
				var subelement_width = content_area.width();
				
				if(total_elements > 4)
					subelement_width = content_area.width() / 2 - 15;
				if (total_elements > 8)
					subelement_width = content_area.width() / 3 - 15;	
				if (total_elements > 16)
					subelement_width = content_area.width() / 4 - 15;
				
				$.each(images, 
					function(index, value)
					{
						console.debug('Creating image: portfolio/'+ value +' with width '+ subelement_width);
						var image = $('<img />', 
							{
								src: 'portfolio/'+ value
							}
						).width(subelement_width).appendTo(content_area);
						
						/*image.width(subelement_width);
						image.appendTo(content_area);*/
					}
				)
			}
			
			function AddVideos(content_area, videos)
			{
				if(videos == null)
					return;
					
				var total_elements = videos.length; /* + videos.length + webpages.length;*/
				
				var subelement_width = content_area.width();
				
				if(total_elements > 4)
					subelement_width = content_area.width() / 2 - 15;
				if (total_elements > 8)
					subelement_width = content_area.width() / 3 - 15;	
				if (total_elements > 16)
					subelement_width = content_area.width() / 4 - 15;
				
				$.each(videos, 
					function(index, value)
					{
						console.debug('Creating video: portfolio/'+ value +' with width '+ subelement_width);

						content_area.append(
							'<video width=\''+ subelement_width +'\' controls>'+
							'	<source src=\'portfolio/'+ value +'\' type="video/mp4">'+
							'	Your browser does not support the video tag.'+
							'</video>'
							)
						/*
						var video = $('<video />', {width: subelement_width}).appendTo(content_area);
						
						video.html('Your browser does not support the video tag.');
						
						$('<source />', 
							{
								src: 'portfolio/'+ value,
								type: 'video/mp4'
							}
						).appendTo(video);
						*/
					}
				)
			}			

			function GetArrayByKey(element, list_key)
			{
				if(element.hasOwnProperty(list_key))
				{
					var array = element[list_key];
					
					if($.isArray(array))
						return array
				}

				return null; 					
			}
			
			function GetComplexElementList(element)
			{
				var complex_elements = [];

				$.each(
					element, 
					function(key, value) 
					{
						if(!$.isArray(value))
						{
							complex_elements.push({'key': key, 'value': value});
						}
					}
				)
				
				return complex_elements;
			}
			
			function HasNestedElements(element)
			{
				var has_nested_elements = false;
			
				$.each(
					element, 
					function(key, value) 
					{
						if(!$.isArray(value))
						{
							has_nested_elements = true;
							return false;
						}
					}
				)
				
				return has_nested_elements;
			}
		</script>	
	</head>

	<body onload='CreateNavigationFromIndexJson()'>
		<header>Portfolio of Jouni Sarvanko</header>
		
		<nav id='portfolio_navigation'>
			<ul id='level_1'>
			</ul>
		</nav>		
		
		<chapter id='content_area'>
			<!--<img src="bedroom.png" alt="Mountain View" style="width:600px;">-->
		<!--
			<video width="600" controls>
				<source src="starship_enterprise_2.mp4" type="video/mp4">
				Your browser does not support the video tag.
			</video>
			-->
		</chapter>
		
		<footer id='contact_info'>
			<p>Copyright &copy; 2015 Jouni Sarvanko. All Rights Reserved.</p>
			<p>Contact information: <a href="uttumi@gmail.com">
			uttumi@gmail.com</a></p>
		</footer>

		<footer id='date'>
			<time>15.02.2015</time>
		</footer>
	</body>
</html>
